<style>
        /* èµ„æºåº“å¸ƒå±€ */
        .res-split-pane { display: flex; gap: 20px; height: 600px; }
        .res-left { flex: 1; border-right: 1px solid #ddd; padding-right: 15px; overflow-y: auto; }
        .res-right { flex: 1; padding-left: 5px; display: flex; flex-direction: column; }
        .res-results { flex: 1; overflow-y: auto; border: 1px dashed #ccc; border-radius: 6px; padding: 10px; background: #f9f9f9; }
        
        /* æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ */
        .upload-area { border: 2px dashed #0d6efd; border-radius: 8px; padding: 30px; text-align: center; background: #f8f9fa; cursor: pointer; transition: all 0.2s; }
        .upload-area:hover { background: #e9ecef; border-color: #0b5ed7; }
    </style>

<div id="page-res-video" class="page-view">
    <div class="res-split-pane">
        <div class="res-left">
            <h6 class="sticky-top py-2 border-bottom">ğŸ“‚ æœ¬åœ°å·²ä¸‹è½½</h6>
            <input type="text" id="resLocalVideoSearch" class="form-control mb-2 form-control-sm" placeholder="ç­›é€‰æœ¬åœ°..." oninput="filterResourceVideos()">
            <div id="resLocalGrid" class="row g-2">
                {% for v in videos %}
                <div class="col-6 res-item" data-name="{{v}}">
                    <div class="card h-100">
                        <video src="/static/video/{{v}}" class="card-img-top" style="object-fit:cover" controls></video>
                        <div class="card-body p-1"><div class="small text-truncate" title="{{v}}">{{v}}</div></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="res-right">
            <h6 class="sticky-top py-2 border-bottom text-primary">ğŸŒ åœ¨çº¿æœç´¢ (Pexels)</h6>
            <div class="input-group mb-2">
                <input type="text" id="resOnlineVideoInput" class="form-control form-control-sm" placeholder="è‹±æ–‡å…³é”®è¯...">
                <button class="btn btn-primary btn-sm" onclick="searchResOnlineVideo(this)">ğŸ” æœç´¢</button>
            </div>
            <div id="resOnlineGrid" class="res-results">
                <div class="text-center text-muted small mt-5">è¾“å…¥å…³é”®è¯æœç´¢é¢„è§ˆï¼Œç‚¹å‡»ä¸‹è½½å…¥åº“</div>
            </div>
        </div>
    </div>
</div>

<div id="page-res-sfx" class="page-view">
    <div class="res-split-pane">
        <div class="res-left">
            <h6 class="sticky-top py-2 border-bottom">ğŸ“‚ æœ¬åœ°éŸ³æ•ˆ</h6>
            <input type="text" id="resLocalSfxSearch" class="form-control mb-2 form-control-sm" placeholder="ç­›é€‰..." oninput="filterResourceSfx()">
            <div class="list-group" id="resSfxList">
                {% for s in sfx_list %}
                <div class="list-group-item p-2 res-sfx-item" data-name="{{s}}">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-2 overflow-hidden" style="max-width: 80%;">
                            <span class="badge bg-secondary rounded-pill" style="font-size:10px">MP3</span>
                            <span class="small text-truncate" title="{{s}}">{{s}}</span>
                        </div>
                        <button class="btn btn-xs btn-outline-primary rounded-circle" onclick="playSfx('{{s}}')">â–¶ï¸</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="res-right">
            <h6 class="sticky-top py-2 border-bottom text-success">ğŸŒ åœ¨çº¿æœç´¢ (MyInstants)</h6>
            <div class="input-group mb-2">
                <input type="text" id="resOnlineSfxInput" class="form-control form-control-sm" placeholder="å…³é”®è¯ (å¦‚: boom, laugh)...">
                <button class="btn btn-success btn-sm" onclick="searchResOnlineSfx(this)">ğŸ” æœç´¢</button>
            </div>
            <div id="resSfxOnlineResults" class="res-results">
                <div class="text-center text-muted small mt-5">æ— éœ€ Keyï¼Œç›´æ¥æœç´¢å¹¶ä¸‹è½½</div>
            </div>
        </div>
    </div>
</div>

<div id="page-res-bgm" class="page-view">
    <div class="res-split-pane">
        <div class="res-left">
            <h6 class="sticky-top py-2 border-bottom">ğŸµ æœ¬åœ°éŸ³ä¹åº“</h6>
            <div class="list-group" id="resMusicList">
                {% for m in music %}
                <div class="list-group-item p-2 d-flex justify-content-between align-items-center" id="music-item-{{loop.index}}">
                    <span class="small">ğŸµ {{m}}</span>
                    <div>
                        <button class="btn btn-xs btn-outline-primary me-1" onclick="playMusic('{{m}}')">â–¶ï¸</button>
                        <button class="btn btn-xs btn-outline-danger" onclick="deleteMusic('{{m}}', this)">ğŸ—‘ï¸</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="res-right">
            <h6 class="sticky-top py-2 border-bottom text-info">â¬†ï¸ ä¸Šä¼ éŸ³ä¹</h6>
            <div class="upload-area mt-3" onclick="document.getElementById('musicFileInput').click()">
                <h3 class="text-muted">ğŸ“‚</h3>
                <p class="mb-0 text-muted">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½ MP3/WAV æ–‡ä»¶</p>
                <input type="file" id="musicFileInput" accept=".mp3,.wav" style="display:none" onchange="uploadMusic(this)">
            </div>
            <div id="uploadStatus" class="mt-3 text-center small text-muted"></div>
        </div>
    </div>
</div>

<script>
    // --- è§†é¢‘ç´ ææœç´¢åŠŸèƒ½ --- 
    
    // æœ¬åœ°è§†é¢‘æœç´¢
    function filterResourceVideos() {
        const searchInput = document.getElementById('resLocalVideoSearch');
        if (!searchInput) return;
        
        const searchTerm = searchInput.value.toLowerCase().trim();
        const items = document.querySelectorAll('.res-item');
        
        items.forEach(item => {
            const name = item.getAttribute('data-name') || '';
            if (name.toLowerCase().includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    // åœ¨çº¿è§†é¢‘æœç´¢
    async function searchResOnlineVideo(btn) {
        const input = document.getElementById('resOnlineVideoInput');
        if (!input) {
            alert('æœç´¢è¾“å…¥æ¡†ä¸å­˜åœ¨');
            return;
        }
        
        const query = input.value.trim();
        if (!query) {
            alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
            return;
        }
        
        const resultsContainer = document.getElementById('resOnlineGrid');
        if (!resultsContainer) return;
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        btn.disabled = true;
        const oldText = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> æœç´¢ä¸­...';
        resultsContainer.innerHTML = '<div class="text-center text-muted">æœç´¢ä¸­...</div>';
        
        try {
            // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„APIï¼Œç°åœ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
            // const res = await fetch(`/api/search-video?query=${encodeURIComponent(query)}`);
            // const data = await res.json();
            
            // æ¨¡æ‹Ÿæ•°æ®
            const mockData = {
                videos: [
                    { id: 1, url: 'https://example.com/video1.mp4', title: 'Sample Video 1', duration: '00:30' },
                    { id: 2, url: 'https://example.com/video2.mp4', title: 'Sample Video 2', duration: '01:00' }
                ]
            };
            
            // æ¸²æŸ“ç»“æœ
            if (mockData.videos && mockData.videos.length > 0) {
                resultsContainer.innerHTML = '';
                mockData.videos.forEach(video => {
                    const card = document.createElement('div');
                    card.className = 'col-6 res-item';
                    card.innerHTML = `
                        <div class="card h-100">
                            <video src="${video.url}" class="card-img-top" style="object-fit:cover" controls></video>
                            <div class="card-body p-1">
                                <div class="small text-truncate" title="${video.title}">${video.title}</div>
                                <div class="small text-muted">${video.duration}</div>
                            </div>
                        </div>
                    `;
                    resultsContainer.appendChild(card);
                });
            } else {
                resultsContainer.innerHTML = '<div class="text-center text-muted">æ— æœç´¢ç»“æœ</div>';
            }
        } catch (error) {
            console.error('æœç´¢é”™è¯¯:', error);
            resultsContainer.innerHTML = '<div class="text-center text-danger">æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
        } finally {
            btn.disabled = false;
            btn.innerHTML = oldText;
        }
    }
    
    // éŸ³æ•ˆæœç´¢ç›¸å…³å‡½æ•°
    function filterResourceSfx() {
        const searchInput = document.getElementById('resLocalSfxSearch');
        if (!searchInput) return;
        
        const searchTerm = searchInput.value.toLowerCase().trim();
        const items = document.querySelectorAll('.res-sfx-item');
        
        items.forEach(item => {
            const name = item.getAttribute('data-name') || '';
            if (name.toLowerCase().includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    async function searchResOnlineSfx(btn) {
        const input = document.getElementById('resOnlineSfxInput');
        if (!input) {
            alert('æœç´¢è¾“å…¥æ¡†ä¸å­˜åœ¨');
            return;
        }
        
        const query = input.value.trim();
        if (!query) {
            alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
            return;
        }
        
        const resultsContainer = document.getElementById('resSfxOnlineResults');
        if (!resultsContainer) return;
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        btn.disabled = true;
        const oldText = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> æœç´¢ä¸­...';
        resultsContainer.innerHTML = '<div class="text-center text-muted">æœç´¢ä¸­...</div>';
        
        try {
            // æ¨¡æ‹Ÿæ•°æ®
            const mockData = {
                sfx: [
                    { id: 1, name: 'boom.mp3', url: 'https://example.com/boom.mp3' },
                    { id: 2, name: 'ding.mp3', url: 'https://example.com/ding.mp3' }
                ]
            };
            
            // æ¸²æŸ“ç»“æœ
            if (mockData.sfx && mockData.sfx.length > 0) {
                resultsContainer.innerHTML = '';
                mockData.sfx.forEach(sfx => {
                    const item = document.createElement('div');
                    item.className = 'list-group-item p-2';
                    item.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center gap-2 overflow-hidden" style="max-width: 80%;">
                                <span class="badge bg-secondary rounded-pill" style="font-size:10px">MP3</span>
                                <span class="small text-truncate" title="${sfx.name}">${sfx.name}</span>
                            </div>
                            <button class="btn btn-xs btn-outline-primary rounded-circle" onclick="playSfx('${sfx.name}')">â–¶ï¸</button>
                        </div>
                    `;
                    resultsContainer.appendChild(item);
                });
            } else {
                resultsContainer.innerHTML = '<div class="text-center text-muted">æ— æœç´¢ç»“æœ</div>';
            }
        } catch (error) {
            console.error('æœç´¢é”™è¯¯:', error);
            resultsContainer.innerHTML = '<div class="text-center text-danger">æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
        } finally {
            btn.disabled = false;
            btn.innerHTML = oldText;
        }
    }
    
    // æ’­æ”¾éŸ³æ•ˆ
    function playSfx(filename) {
        if (!filename) return;
        // è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„éŸ³æ•ˆæ’­æ”¾é€»è¾‘
        console.log('æ’­æ”¾éŸ³æ•ˆ:', filename);
    }
    
    // æ’­æ”¾éŸ³ä¹
    function playMusic(filename) {
        if (!filename) return;
        // è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„éŸ³ä¹æ’­æ”¾é€»è¾‘
        console.log('æ’­æ”¾éŸ³ä¹:', filename);
    }
    
    // åˆ é™¤éŸ³ä¹
    function deleteMusic(filename, btn) {
        if (!filename) return;
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªéŸ³ä¹æ–‡ä»¶å—ï¼Ÿ')) {
            // è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„éŸ³ä¹åˆ é™¤é€»è¾‘
            console.log('åˆ é™¤éŸ³ä¹:', filename);
            // ç§»é™¤DOMå…ƒç´ 
            const item = btn.closest('.list-group-item');
            if (item) {
                item.remove();
            }
        }
    }
    
    // ä¸Šä¼ éŸ³ä¹
    function uploadMusic(input) {
        const file = input.files[0];
        if (!file) return;
        
        const status = document.getElementById('uploadStatus');
        if (status) {
            status.textContent = 'ä¸Šä¼ ä¸­...';
        }
        
        // è¿™é‡Œåº”è¯¥å®ç°å®é™…çš„æ–‡ä»¶ä¸Šä¼ é€»è¾‘
        setTimeout(() => {
            if (status) {
                status.textContent = 'ä¸Šä¼ å®Œæˆ';
                setTimeout(() => {
                    status.textContent = '';
                }, 2000);
            }
            // é‡ç½®input
            input.value = '';
        }, 1000);
    }
</script>